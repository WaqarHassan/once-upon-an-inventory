<h1>New Invoice</h1>

<%# render 'form', invoice: @invoice %>
<div class = "row">
  <div class="col-md-10">
    <table class="table">
      <thead>
      <tr class="item-row">
        <th>Item</th>
        <th>Price</th>
        <th>Quantity</th>
        <th>Total</th>
      </tr>
      </thead>
      <tbody>
      <tr id="hiderow">
        <td colspan="4">
          <a id="addRow" href="javascript:;" title="Add a row" class="btn btn-primary">Add a row</a>
        </td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td class="text-right"><strong>Sub Total</strong></td>
        <td><span id="subtotal">0.00</span></td>
      </tr>
      <tr>
        <td><strong>Total Quantity: </strong><span id="totalQty" style="color: red; font-weight: bold">0</span> Units
        </td>
        <td></td>
        <td class="text-right"><strong>Discount</strong></td>
        <td><input class="form-control" id="discount" value="0" type="text"></td>
      </tr>
      <tr class = "hide">
        <td></td>
        <td></td>
        <td class="text-right"><strong>Shipping</strong></td>
        <td><input class="form-control" id="shipping" value="0" type="text"></td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td class="text-right"><strong>Grand Total</strong></td>
        <td><span id="grandTotal">0</span></td>
      </tr>
      </tbody>
    </table>

  </div>
</div>

<script>
    window.drugs = <%= raw @d.to_json %>
    jQuery().invoice({
        addRow: "#addRow",
        delete: ".delete",
        parentClass: ".item-row",

        price: ".price",
        qty: ".qty",
        total: ".total",
        totalQty: "#totalQty",

        subtotal: "#subtotal",
        discount: "#discount",
        shipping: "#shipping",
        grandTotal: "#grandTotal"
    });
    var availableTags = Object.keys(window.drugs)
    $(function () {

        // $("#item").last()
    });
    $(document).on('focus','.item', {} ,function(e){
        $(e.currentTarget).autocomplete({
            source: availableTags,
            "ui-autocomplete": "highlight",
            select: function( event, ui ) {
                // debugger
                $(this).parents(".item-row").find(".price").val(window.drugs[ui.item.value])
                // $(".price").val(window.drugs[ui.item.value])
            },
            change: function (event, ui) {
                // $(".price").val(window.drugs[ui.item.value])
                $(this).parents(".item-row").find(".price").val(window.drugs[ui.item.value])
            }
        });
    })
</script>

<%= link_to 'Back', invoices_path %>
